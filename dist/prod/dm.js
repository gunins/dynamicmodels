define("dm/Mediator",[],function(){function t(t){this._channel=t,this._handlers={}}return t.prototype.subscribe=function(t,e,n){var r,i;t=t.split(":"),r=void 0===t[1]?"_":t[1],i=t[0],this._handlers[r]=this._handlers[r]||{},this._handlers[r][i]=this._handlers[r][i]||[];var o=this._handlers[r][i],s=e.bind(n||this);return o.push(s),{remove:function(){o.splice(o.indexOf(s),1)}}},t.prototype.publish=function(t){if(void 0!==this._channel&&void 0!==this._channel.postMessage){var e={name:t,data:Array.prototype.slice.call(arguments,1)};this._channel.postMessage(e)}},t.prototype.listen=function(t){var e,n,r,i=Array.prototype.slice.call(arguments,1);if(r=t.split(":"),e=void 0===r[1]?"_":r[1],n=r[0],void 0!==this._handlers[e]&&void 0!==this._handlers[e][n]){var o=this._handlers[e][n];o.forEach(function(t){t.apply(null,i)})}},t}),define("dm/ModelMediator",[],function(){"use strict";function t(t){t=t||{},this.mediator=t.mediator,this.name=t.name,this._ready=!1,this.onHold=[]}return t.prototype.subscribe=function(t,e,n){return this.mediator.subscribe(this.name+":"+t,e,n)},t.prototype.publish=function(){this._ready?this.callEvents.apply(this,arguments):this.onHold.push(arguments)},t.prototype.callEvents=function(t){var e=this.mediator,n=Array.prototype.slice.call(arguments,1);e.publish.apply(e,[this.name+":"+t].concat(n))},t.prototype.ready=function(){if(this.onHold.length>0)for(;this.onHold.length>0;)this.callEvents.apply(this,this.onHold[0]),this.onHold.shift();this._ready=!0},t}),define("dm/Getter",["./ModelMediator"],function(t){"use strict";function e(e){e=e||{},this.name=e.name,this.context={eventBus:e.eventBus},this.eventBus=new t({mediator:this.context.eventBus,name:this.name})}return e.prototype.ready=function(){this.eventBus.ready()},e}),define("dm/Manager",["./Mediator","./Getter"],function(t,e){function n(e){this._channel=e,this.eventBus=new t(e),this._models={},this.listenMessage(e),this.eventBus.subscribe("modelReady",this.modelReady.bind(this))}return n.prototype.addModel=function(t){this.eventBus.publish("loadModel",t);var n=new e({name:t.name,eventBus:this.eventBus});return this._models[t.name]=n,n},n.prototype.modelReady=function(t){void 0!==this._models[t]&&this._models[t].ready()},n.prototype.listenMessage=function(t){t.addEventListener("message",function(t){this.fireMessage(t)}.bind(this))},n.prototype.fireMessage=function(t){var e=t.data;void 0!==e.name&&this.eventBus.listen.apply(this.eventBus,[e.name].concat(e.data))},n}),define("dm/utils",[],function(){function t(t){var e=typeof t;if(!("function"===e||"object"===e&&t))return t;for(var n,r,i=1,o=arguments.length;o>i;i++){n=arguments[i];for(r in n)t[r]=n[r]}return t}function e(e,n){var r,i=this;r=e&&null!=e&&hasOwnProperty.call(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)},t(r,i,n);var o=function(){this.constructor=r};return o.prototype=i.prototype,r.prototype=new o,e&&t(r.prototype,e),r.__super__=i.prototype,r}function n(t){return"[object String]"===toString.call(t)}function r(t){var e=typeof t;return"function"===e||"object"===e&&!!t}function i(t){return"[object Array]"===toString.call(t)}return{fnExtend:e,extend:t,isString:n,isObject:r,isArray:i}}),define("dm",["./dm/Manager","./dm/utils"],function(t,e){var n=!1,r=!1;return{load:function(i,o,s,a){if(a.isBuild)return void s();if(void 0===a.name)throw"App Name has to be defined";if(!n&&!r)if(void 0!==window.SharedWorker)n=new SharedWorker(require.toUrl("dm/sharedWorker.js"),a.name||"my-shared-scope"),n.port.start(),r=new t(n.port);else{if(void 0===window.Worker)throw console.log("WEB WORKERS ARE NOT SUPPORTED"),"Web Workers are not supported!";n=new Worker(require.toUrl("dm/worker.js")),r=new t(n)}var d=o.toUrl("dm").replace(/\.\.\//g,""),u=(d.match(/\//g)||[]).length,h="./";if(u>0)for(var l=0;u>l;l++)h+="../";var c=r.addModel({name:i,config:e.extend({},a,{baseUrl:h+a.name})});s(c)}}});